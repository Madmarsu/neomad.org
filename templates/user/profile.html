{% extends 'layout.html' %}

{% block extra_css %}
<link rel=stylesheet href={{ url_for('static', filename='css/profile.css') }}>
{% endblock %}

{% block main %}
<header>
{% if edit %}
<form edit method=post action={{ url_for('profile_edit') }} enctype=multipart/form-data>
{% endif %}
  <figure>
    <img class=avatar src={{ user.avatar }} width=100 height=100>
    {% if edit %}<input type=file name=picture>{% endif %}
  </figure>
  <div>
    <h1 contenteditable={{edit|boolean}} name=username>{{ user.username or 'My username' }}</h1>
    <!--<section>{{ user.about }}</section>-->
    <p contenteditable={{edit|boolean}} name=about>{{ user.about|htmlnewline }}</p>
  </div>
{% if edit %}
  <div class=toolbar>
    <input type=hidden name=username>
    <input type=hidden name=about>
    <button type=submit>Save</button>
  </div>
</form>
<script>
  document.forms[0].addEventListener('submit', event => {
    event.target.username.value = document.querySelector('[contenteditable][name=username]').innerHTML
    event.target.about.value = document.querySelector('[contenteditable][name=about]').innerHTML
  })
</script>
{% endif %}
</header>

<section class=articles>
{% if edit %}
  <article class=preview>
    <h1><span class="newtext title">&nbsp;</span></h1>
    <p><span class=newtext>&nbsp;</span><span class=newtext>&nbsp;</span><span class=newtext>&nbsp;</span></p>
    <a href={{ url_for('article_create') }} class=read>Write this article</a>
  </article>
{% endif %}
{% for article in articles %}
  {% set url = url_for('article', author=user.slug, slug=article.slug) | replace('%40', '@') %}
  <article class=preview>
    <a href={{ url }}>
      <h1>{{ article.title|title }}</h1>
      {{ article.content|striptags|truncate(200) }}
    </a>
    <a href={{ url }} class=read>Read</a>
  </article>
{% endfor %}
</section>
{% endblock %}
